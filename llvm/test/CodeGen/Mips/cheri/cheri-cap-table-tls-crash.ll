; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -o - -mtriple=cheri-unknown-rtems5 -relocation-model=pic -thread-model=posix -mattr=-noabicalls -mattr=+chericap -mattr=+cheri128 -target-abi purecap -float-abi=soft -mcpu=cheri128 -O0 -cheri-cap-table-abi=pcrel -verify-machineinstrs %s | FileCheck %s
; ModuleID = '***/build/init-a31849-bugpoint-reduce.ll-reduced-simplified.bc'
; See https://github.com/CTSRD-CHERI/llvm/issues/275

source_filename = "/tmp/init-a31849.c"
target datalayout = "E-m:e-pf200:128:128:128:64-i8:8:32-i16:16:32-i64:64-n32:64-S128-A200-P200-G200"
target triple = "cheri-unknown-rtems5"

@tls_item = external dso_local thread_local(initialexec) addrspace(200) global i8, align 1
@.str.6 = external dso_local unnamed_addr addrspace(200) constant [15 x i8], align 1

declare void @printf(i8 addrspace(200)*, ...) addrspace(200)

; Function Attrs: noinline nounwind optnone uwtable
define dso_local void @check_tls_item() addrspace(200) #0 {
entry:
  call void (i8 addrspace(200)*, ...) @printf(i8 addrspace(200)* getelementptr inbounds ([15 x i8], [15 x i8] addrspace(200)* @.str.6, i32 0, i32 0), i32 signext undef)
  %0 = load volatile i8, i8 addrspace(200)* @tls_item, align 1
  ret void

  ; CHECK:      lui	$1, %captab_tprel_hi(tls_item)
  ; CHECk-NEXT: daddiu	$1, $1, %captab_tprel_lo(tls_item)
  ; CHECK:      creadhwr	$c2, $chwr_userlocal
}

attributes #0 = { noinline nounwind optnone uwtable }
