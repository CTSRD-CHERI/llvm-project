; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: %cheri_llc -o - -relocation-model=static %s | FileCheck %s
; https://github.com/CTSRD-CHERI/llvm/issues/228

; Function Attrs: inlinehint nounwind
define void @CHERIABI_SYS_mknodat_fill_uap() nounwind {
; CHECK-LABEL: CHERIABI_SYS_mknodat_fill_uap:
; CHECK:       # %bb.0: # %cheriabi_fetch_syscall_arg.exit119
; CHECK-NEXT:    ctoptr $1, $c1, $ddc
; CHECK-NEXT:    sll $1, $1, 0
; CHECK-NEXT:    sh $1, 0($1)
cheriabi_fetch_syscall_arg.exit119:
  %0 = ptrtoint ptr addrspace(200) undef to i16
  store i16 %0, ptr undef, align 2
  unreachable
}

define void @CHERIABI_SYS_mknodat_fill_uap1() nounwind {
; CHECK-LABEL: CHERIABI_SYS_mknodat_fill_uap1:
; CHECK:       # %bb.0: # %cheriabi_fetch_syscall_arg.exit119
; CHECK-NEXT:    .insn
cheriabi_fetch_syscall_arg.exit119:
  %0 = getelementptr i8, ptr addrspace(200) null, i64 undef
  store ptr addrspace(200) %0, ptr undef, align 16
  unreachable
}

define void @CHERIABI_SYS_mknodat_fill_uap2(ptr addrspace(200) %arg) nounwind {
; CHECK-LABEL: CHERIABI_SYS_mknodat_fill_uap2:
; CHECK:       # %bb.0: # %cheriabi_fetch_syscall_arg.exit119
; CHECK-NEXT:    ctoptr $1, $c3, $ddc
; CHECK-NEXT:    sll $1, $1, 0
; CHECK-NEXT:    sh $1, 0($1)
cheriabi_fetch_syscall_arg.exit119:
  %0 = ptrtoint ptr addrspace(200) %arg to i16
  store i16 %0, ptr undef, align 2
  unreachable
}

define void @CHERIABI_SYS_mknodat_fill_uap3(ptr addrspace(200) %arg, ptr %ptr) nounwind {
; CHECK-LABEL: CHERIABI_SYS_mknodat_fill_uap3:
; CHECK:       # %bb.0: # %cheriabi_fetch_syscall_arg.exit119
; CHECK-NEXT:    ctoptr $1, $c3, $ddc
; CHECK-NEXT:    sll $1, $1, 0
; CHECK-NEXT:    jr $ra
; CHECK-NEXT:    sh $1, 0($4)
cheriabi_fetch_syscall_arg.exit119:
  %0 = ptrtoint ptr addrspace(200) %arg to i16
  store i16 %0, ptr %ptr, align 2
  ret void
}
