// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py
// RUN: %cheri_purecap_cc1 -x c++ -std=c++11 -emit-llvm -o - %s | %cheri_FileCheck %s

// Previously this would crash in ::ScalarExprEmitter::EmitScalarConversion due
// to an overly-strict assertion that the cast source was an integer.

enum class E;
enum E e;
// CHECK-LABEL: @_Z3foov(
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[TMP0:%.*]] = load i32, i32 addrspace(200)* @e, align 4
// CHECK-NEXT:    [[CONV:%.*]] = sext i32 [[TMP0]] to i64
// CHECK-NEXT:    [[TMP1:%.*]] = getelementptr i8, i8 addrspace(200)* null, i64 [[CONV]]
// CHECK-NEXT:    ret i8 addrspace(200)* [[TMP1]]
//
__intcap foo() {
  return static_cast<__intcap>(e);
}
