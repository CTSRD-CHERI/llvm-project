// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py UTC_ARGS: --function-signature
// RUN: %cheri_purecap_cc1 -O1 -mllvm -cheri-cap-table-abi=plt -o - %s -emit-llvm -o - | %cheri_FileCheck %s

typedef void(*fnptr)(void);

void extern_func(void);

fnptr fn = &extern_func;
static fnptr fn2 = &extern_func;

// CHECK-LABEL: define {{[^@]+}}@test
// CHECK-SAME: () local_unnamed_addr addrspace(200) #[[ATTR1:[0-9]+]] {
// CHECK-NEXT:  entry:
// CHECK-NEXT:    [[TMP0:%.*]] = load void () addrspace(200)*, void () addrspace(200)* addrspace(200)* @fn, align 16, !tbaa [[TBAA2:![0-9]+]]
// CHECK-NEXT:    store void () addrspace(200)* [[TMP0]], void () addrspace(200)* addrspace(200)* @fn2, align 16, !tbaa [[TBAA2]]
// CHECK-NEXT:    call void [[TMP0]]() #[[ATTR2:[0-9]+]]
// CHECK-NEXT:    ret void
//
void test(void) {
  fn2 = fn;
  fn();
}

